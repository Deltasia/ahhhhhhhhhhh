<!-- <!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>YOLO Realtime Webcam</title>
  <style>
    body { font-family: Arial, sans-serif; display:flex; gap:20px; padding:20px; }
    video, img { width: 640px; height: 480px; background: #222; }
    #controls { display:flex; flex-direction:column; gap:8px; }
  </style>
</head>
<body>
  <div>
    <h3>Local webcam (sending frames)</h3>
    <video id="video" autoplay playsinline></video>
    <div>FPS send: <span id="sendFps">-</span></div>
  </div>

  <div id="controls">
    <h3>Server annotated</h3>
    <img id="annotated" alt="annotated frame" />
    <div>Server FPS: <span id="serverFps">-</span></div>
    <label>Confidence threshold: <input type="range" id="conf" min="0.1" max="0.9" step="0.05" value="0.25"></label>
    <button id="startBtn">Start</button>
    <button id="stopBtn">Stop</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"
    integrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer"></script>
   <script src="/static/main.js"></script> -->
<!-- </body>
</html>  -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Realtime YOLO Webcam</title>
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"></script>
  <style>
    :root {
      color-scheme: dark light;
    }

    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 24px;
      background: #0f172a;
      color: #e2e8f0;
    }

    .container {
      display: flex;
      flex-wrap: wrap;
      gap: 24px;
      align-items: flex-start;
    }

    .panel {
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: 16px;
      box-shadow: 0 16px 40px rgba(15, 23, 42, 0.35);
      padding: 24px;
      flex: 1 1 320px;
      min-width: 300px;
    }

    h1 {
      margin-top: 0;
      margin-bottom: 16px;
      font-weight: 600;
      letter-spacing: 0.02em;
    }

    h2 {
      margin-top: 0;
      font-size: 1.2rem;
      font-weight: 500;
    }

    #video-stream {
      display: block;
      width: 100%;
      max-width: 640px;
      height: auto;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.35);
    }

    dl {
      margin: 0;
      display: grid;
      grid-template-columns: auto 1fr;
      row-gap: 8px;
      column-gap: 16px;
      font-size: 0.95rem;
    }

    dt {
      color: #94a3b8;
    }

    dd {
      margin: 0;
      font-variant-numeric: tabular-nums;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 20px;
    }

    button {
      padding: 10px 18px;
      border-radius: 999px;
      border: none;
      background: #38bdf8;
      color: #0f172a;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    button.secondary {
      background: transparent;
      color: #e2e8f0;
      border: 1px solid rgba(148, 163, 184, 0.35);
    }

    button:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    button:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 10px 20px rgba(14, 165, 233, 0.25);
    }

    .status {
      margin-top: 16px;
      padding: 12px 16px;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.2);
      font-size: 0.9rem;
      background: rgba(30, 41, 59, 0.6);
    }

    .hint {
      margin-top: 12px;
      color: rgba(226, 232, 240, 0.7);
      font-size: 0.85rem;
      line-height: 1.5;
    }

    .error {
      margin-top: 12px;
      color: #f87171;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <section class="panel">
      <h1>Realtime YOLO Object Detection</h1>
      <img id="video-stream" src="{{ url_for('video') }}" alt="Video stream">
      <div id="calibration-status" class="status">Loading camera status…</div>
    </section>

    <section class="panel">
      <h2>Measurement dashboard</h2>
      <div id="dashboard" hx-get="/dashboard" hx-trigger="load, every 1s" hx-target="#dashboard" hx-swap="innerHTML">
        <div id="calibration-status" class="status">Loading camera status…</div>
        <dl>
          <dt>Latest distance</dt>
          <dd id="latest-distance">–</dd>
          <dt>Latest angle</dt>
          <dd id="latest-angle">–</dd>
          <dt>Vertical angle</dt>
          <dd id="latest-vertical-angle">–</dd>
          <dt>Reference distance</dt>
          <dd id="reference-distance">–</dd>
          <dt>Reference angle</dt>
          <dd id="reference-angle">–</dd>
          <dt>Δ distance</dt>
          <dd id="delta-distance">–</dd>
          <dt>Δ angle</dt>
          <dd id="delta-angle">–</dd>
          <dt>Lateral shift</dt>
          <dd id="delta-x">–</dd>
          <dt>Forward shift</dt>
          <dd id="delta-z">–</dd>
        </dl>
      </div>

      <div class="btn-row">
        <button id="btn-set-reference" type="button" hx-post="/api/reference" hx-target="#error" hx-swap="innerHTML">Set reference</button>
        <button id="btn-clear-reference" type="button" class="secondary" hx-delete="/api/reference" hx-target="#error" hx-swap="innerHTML">Clear reference</button>
      </div>

      <div id="error" class="error" role="alert" aria-live="polite"></div>

      <p class="hint">
        Point the camera at your target, wait for a detection, then press “Set reference”.
        The dashboard will track how far the object moves relative to that reference point.
      </p>
    </section>

    <section class="panel">
      <h2>Detection Logs</h2>
      <div id="logs" style="max-height: 300px; overflow-y: auto; background: rgba(30, 41, 59, 0.6); padding: 12px; border-radius: 8px; font-family: monospace; font-size: 0.8rem;"></div>
    </section>
  </div>

  <script>
    const socket = io();
    socket.on('log', (data) => {
      const logsDiv = document.getElementById('logs');
      logsDiv.innerHTML += '<pre style="margin: 0; padding: 4px 0;">' + data.replace(/\n/g, '<br>') + '</pre>';
      logsDiv.scrollTop = logsDiv.scrollHeight;
    });
  </script>
</body>
</html>
